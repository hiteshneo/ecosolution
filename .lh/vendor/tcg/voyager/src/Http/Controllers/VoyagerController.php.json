{
    "sourceFile": "vendor/tcg/voyager/src/Http/Controllers/VoyagerController.php",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 14,
            "patches": [
                {
                    "date": 1629478035447,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1629478085519,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -10,14 +10,15 @@\n use Intervention\\Image\\Constraint;\n use Intervention\\Image\\Facades\\Image;\n use League\\Flysystem\\Util;\n use TCG\\Voyager\\Facades\\Voyager;\n+use App\\User;\n \n class VoyagerController extends Controller\n {\n     public function index()\n     {\n-        $totalUser = App\\User::where('role_id', 2)->count();\n+        $totalUser = User::where('role_id', 2)->count();\n         return Voyager::view('voyager::index', compact('totalUser'));\n     }\n \n     public function logout()\n"
                },
                {
                    "date": 1629478167878,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -11,15 +11,18 @@\n use Intervention\\Image\\Facades\\Image;\n use League\\Flysystem\\Util;\n use TCG\\Voyager\\Facades\\Voyager;\n use App\\User;\n+use App\\Models\\Post;\n \n class VoyagerController extends Controller\n {\n     public function index()\n     {\n         $totalUser = User::where('role_id', 2)->count();\n-        return Voyager::view('voyager::index', compact('totalUser'));\n+        $totalPostWall = Post::where('post_tye', 'WALL')->count();\n+        $totalPostReel = User::where('post_type', 'REEL')->count();\n+        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel'));\n     }\n \n     public function logout()\n     {\n"
                },
                {
                    "date": 1629478224037,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -18,9 +18,9 @@\n {\n     public function index()\n     {\n         $totalUser = User::where('role_id', 2)->count();\n-        $totalPostWall = Post::where('post_tye', 'WALL')->count();\n+        $totalPostWall = Post::where('post_type', 'WALL')->count();\n         $totalPostReel = User::where('post_type', 'REEL')->count();\n         return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel'));\n     }\n \n"
                },
                {
                    "date": 1629478239033,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -19,9 +19,9 @@\n     public function index()\n     {\n         $totalUser = User::where('role_id', 2)->count();\n         $totalPostWall = Post::where('post_type', 'WALL')->count();\n-        $totalPostReel = User::where('post_type', 'REEL')->count();\n+        $totalPostReel = Post::where('post_type', 'REEL')->count();\n         return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel'));\n     }\n \n     public function logout()\n"
                },
                {
                    "date": 1629478313139,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -12,17 +12,19 @@\n use League\\Flysystem\\Util;\n use TCG\\Voyager\\Facades\\Voyager;\n use App\\User;\n use App\\Models\\Post;\n+use App\\Models\\PostReport;\n \n class VoyagerController extends Controller\n {\n     public function index()\n     {\n         $totalUser = User::where('role_id', 2)->count();\n         $totalPostWall = Post::where('post_type', 'WALL')->count();\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n-        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel'));\n+        $totalPostReport = PostReport::count();\n+        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport'));\n     }\n \n     public function logout()\n     {\n"
                },
                {
                    "date": 1629478538462,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,11 @@\n         $totalUser = User::where('role_id', 2)->count();\n         $totalPostWall = Post::where('post_type', 'WALL')->count();\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n         $totalPostReport = PostReport::count();\n-        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport'));\n+        $getPostWall = Post::where('post_type', 'WALL')->take(5)->get();\n+        $getPostReel = Post::where('post_type', 'REEL')->take(5)->get();\n+        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel'));\n     }\n \n     public function logout()\n     {\n"
                },
                {
                    "date": 1629478679513,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,9 +22,9 @@\n         $totalUser = User::where('role_id', 2)->count();\n         $totalPostWall = Post::where('post_type', 'WALL')->count();\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n         $totalPostReport = PostReport::count();\n-        $getPostWall = Post::where('post_type', 'WALL')->take(5)->get();\n+        $getPostWall = Post::with()->where('post_type', 'WALL')->take(5)->get();\n         $getPostReel = Post::where('post_type', 'REEL')->take(5)->get();\n         return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel'));\n     }\n \n"
                },
                {
                    "date": 1629478694775,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,10 +22,10 @@\n         $totalUser = User::where('role_id', 2)->count();\n         $totalPostWall = Post::where('post_type', 'WALL')->count();\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n         $totalPostReport = PostReport::count();\n-        $getPostWall = Post::with()->where('post_type', 'WALL')->take(5)->get();\n-        $getPostReel = Post::where('post_type', 'REEL')->take(5)->get();\n+        $getPostWall = Post::with('users')->where('post_type', 'WALL')->take(5)->get();\n+        $getPostReel = Post::with('users')->where('post_type', 'REEL')->take(5)->get();\n         return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel'));\n     }\n \n     public function logout()\n"
                },
                {
                    "date": 1629478808032,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -22,10 +22,10 @@\n         $totalUser = User::where('role_id', 2)->count();\n         $totalPostWall = Post::where('post_type', 'WALL')->count();\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n         $totalPostReport = PostReport::count();\n-        $getPostWall = Post::with('users')->where('post_type', 'WALL')->take(5)->get();\n-        $getPostReel = Post::with('users')->where('post_type', 'REEL')->take(5)->get();\n+        $getPostWall = Post::with('users')->where('post_type', 'WALL')->take(5)->OrderBy('id', 'desc')->get();\n+        $getPostReel = Post::with('users')->where('post_type', 'REEL')->take(5)->OrderBy('id', 'desc')->get();\n         return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel'));\n     }\n \n     public function logout()\n"
                },
                {
                    "date": 1629479206915,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,8 +24,9 @@\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n         $totalPostReport = PostReport::count();\n         $getPostWall = Post::with('users')->where('post_type', 'WALL')->take(5)->OrderBy('id', 'desc')->get();\n         $getPostReel = Post::with('users')->where('post_type', 'REEL')->take(5)->OrderBy('id', 'desc')->get();\n+        $getUserList = User::where('role_id', 2)->take(5)->OrderBy('id', 'desc')->get();\n         return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel'));\n     }\n \n     public function logout()\n"
                },
                {
                    "date": 1629479212372,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -25,9 +25,9 @@\n         $totalPostReport = PostReport::count();\n         $getPostWall = Post::with('users')->where('post_type', 'WALL')->take(5)->OrderBy('id', 'desc')->get();\n         $getPostReel = Post::with('users')->where('post_type', 'REEL')->take(5)->OrderBy('id', 'desc')->get();\n         $getUserList = User::where('role_id', 2)->take(5)->OrderBy('id', 'desc')->get();\n-        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel'));\n+        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel', getUserList''));\n     }\n \n     public function logout()\n     {\n"
                },
                {
                    "date": 1629479357273,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,10 +24,10 @@\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n         $totalPostReport = PostReport::count();\n         $getPostWall = Post::with('users')->where('post_type', 'WALL')->take(5)->OrderBy('id', 'desc')->get();\n         $getPostReel = Post::with('users')->where('post_type', 'REEL')->take(5)->OrderBy('id', 'desc')->get();\n-        $getUserList = User::where('role_id', 2)->take(5)->OrderBy('id', 'desc')->get();\n-        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel', getUserList''));\n+        $getUserList = User::where(['role_id' => 2])->take(5)->OrderBy('id', 'desc')->get();\n+        return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel', 'getUserList'));\n     }\n \n     public function logout()\n     {\n"
                },
                {
                    "date": 1629479392185,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -24,9 +24,9 @@\n         $totalPostReel = Post::where('post_type', 'REEL')->count();\n         $totalPostReport = PostReport::count();\n         $getPostWall = Post::with('users')->where('post_type', 'WALL')->take(5)->OrderBy('id', 'desc')->get();\n         $getPostReel = Post::with('users')->where('post_type', 'REEL')->take(5)->OrderBy('id', 'desc')->get();\n-        $getUserList = User::where(['role_id' => 2])->take(5)->OrderBy('id', 'desc')->get();\n+        $getUserList = User::where(['role_id' => 2])->where('name', '!=', '')->take(5)->OrderBy('id', 'desc')->get();\n         return Voyager::view('voyager::index', compact('totalUser', 'totalPostWall', 'totalPostReel', 'totalPostReport', 'getPostWall', 'getPostReel', 'getUserList'));\n     }\n \n     public function logout()\n"
                },
                {
                    "date": 1629479695153,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,5 +101,27 @@\n \n         if (File::exists($path)) {\n             $mime = '';\n             if (Str::endsWith($path, '.js')) {\n-                $mime = 'text/javasc\n\\ No newline at end of file\n+                $mime = 'text/javascript';\n+            } elseif (Str::endsWith($path, '.css')) {\n+                $mime = 'text/css';\n+            } else {\n+                $mime = File::mimeType($path);\n+            }\n+            $response = response(File::get($path), 200, ['Content-Type' => $mime]);\n+            $response->setSharedMaxAge(31536000);\n+            $response->setMaxAge(31536000);\n+            $response->setExpires(new \\DateTime('+1 year'));\n+\n+            return $response;\n+        }\n+\n+        return response('', 404);\n+    }\n+\n+    protected function userCannotUploadImageIn($dataType, $action)\n+    {\n+        return auth()->user()->cannot($action, app($dataType->model_name))\n+                || $dataType->{$action.'Rows'}->where('type', 'rich_text_box')->count() === 0;\n+    }\n+}\n"
                }
            ],
            "date": 1629478035447,
            "name": "Commit-0",
            "content": "<?php\n\nnamespace TCG\\Voyager\\Http\\Controllers;\n\nuse Illuminate\\Http\\Request;\nuse Illuminate\\Support\\Facades\\Auth;\nuse Illuminate\\Support\\Facades\\File;\nuse Illuminate\\Support\\Facades\\Storage;\nuse Illuminate\\Support\\Str;\nuse Intervention\\Image\\Constraint;\nuse Intervention\\Image\\Facades\\Image;\nuse League\\Flysystem\\Util;\nuse TCG\\Voyager\\Facades\\Voyager;\n\nclass VoyagerController extends Controller\n{\n    public function index()\n    {\n        $totalUser = App\\User::where('role_id', 2)->count();\n        return Voyager::view('voyager::index', compact('totalUser'));\n    }\n\n    public function logout()\n    {\n        Auth::logout();\n\n        return redirect()->route('voyager.login');\n    }\n\n    public function upload(Request $request)\n    {\n        $fullFilename = null;\n        $resizeWidth = 1800;\n        $resizeHeight = null;\n        $slug = $request->input('type_slug');\n        $file = $request->file('image');\n\n        $dataType = Voyager::model('DataType')->where('slug', '=', $slug)->firstOrFail();\n\n        if ($this->userCannotUploadImageIn($dataType, 'add') && $this->userCannotUploadImageIn($dataType, 'edit')) {\n            abort(403);\n        }\n\n        $path = $slug.'/'.date('F').date('Y').'/';\n\n        $filename = basename($file->getClientOriginalName(), '.'.$file->getClientOriginalExtension());\n        $filename_counter = 1;\n\n        // Make sure the filename does not exist, if it does make sure to add a number to the end 1, 2, 3, etc...\n        while (Storage::disk(config('voyager.storage.disk'))->exists($path.$filename.'.'.$file->getClientOriginalExtension())) {\n            $filename = basename($file->getClientOriginalName(), '.'.$file->getClientOriginalExtension()).(string) ($filename_counter++);\n        }\n\n        $fullPath = $path.$filename.'.'.$file->getClientOriginalExtension();\n\n        $ext = $file->guessClientExtension();\n\n        if (in_array($ext, ['jpeg', 'jpg', 'png', 'gif'])) {\n            $image = Image::make($file)\n                ->resize($resizeWidth, $resizeHeight, function (Constraint $constraint) {\n                    $constraint->aspectRatio();\n                    $constraint->upsize();\n                });\n            if ($ext !== 'gif') {\n                $image->orientate();\n            }\n            $image->encode($file->getClientOriginalExtension(), 75);\n\n            // move uploaded file from temp to uploads directory\n            if (Storage::disk(config('voyager.storage.disk'))->put($fullPath, (string) $image, 'public')) {\n                $status = __('voyager::media.success_uploading');\n                $fullFilename = $fullPath;\n            } else {\n                $status = __('voyager::media.error_uploading');\n            }\n        } else {\n            $status = __('voyager::media.uploading_wrong_type');\n        }\n\n        // echo out script that TinyMCE can handle and update the image in the editor\n        return \"<script> parent.helpers.setImageValue('\".Voyager::image($fullFilename).\"'); </script>\";\n    }\n\n    public function assets(Request $request)\n    {\n        try {\n            $path = dirname(__DIR__, 3).'/publishable/assets/'.Util::normalizeRelativePath(urldecode($request->path));\n        } catch (\\LogicException $e) {\n            abort(404);\n        }\n\n        if (File::exists($path)) {\n            $mime = '';\n            if (Str::endsWith($path, '.js')) {\n                $mime = 'text/javascript';\n            } elseif (Str::endsWith($path, '.css')) {\n                $mime = 'text/css';\n            } else {\n                $mime = File::mimeType($path);\n            }\n            $response = response(File::get($path), 200, ['Content-Type' => $mime]);\n            $response->setSharedMaxAge(31536000);\n            $response->setMaxAge(31536000);\n            $response->setExpires(new \\DateTime('+1 year'));\n\n            return $response;\n        }\n\n        return response('', 404);\n    }\n\n    protected function userCannotUploadImageIn($dataType, $action)\n    {\n        return auth()->user()->cannot($action, app($dataType->model_name))\n                || $dataType->{$action.'Rows'}->where('type', 'rich_text_box')->count() === 0;\n    }\n}\n"
        }
    ]
}